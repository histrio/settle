---

- name: Create user
  become: yes
  become_user: root
  user:
    name: "{{ user }}"
    generate_ssh_key: yes
    ssh_key_bits: 2048
    ssh_key_file: ~/.ssh/id_rsa
    shell: /bin/zsh
    update_password: on_create

- name: Upload auth keys
  authorized_key:
    user: "{{ user }}"
    key: "{{ lookup('file', '~/.ssh/id_rsa.pub') }}"

- name: Zsh configuration
  get_url: url={{ item.url }} dest={{ item.dst }}
  with_items:
      - {url: "http://git.grml.org/f/grml-etc-core/etc/zsh/zshrc", dst: ~/.zshrc}
      - {url: "http://git.grml.org/f/grml-etc-core/etc/skel/.zshrc", dst: ~/.zshrc.local}

- name: Get tmux conf
  get_url: url="{{ tmux_url }}" dest=~/.tmux.conf force=yes

- name: Get git conf
  get_url: url="{{ git_conf_url }}" dest=~/.gitconfig force=yes

- name: Get vimrc
  get_url: url="{{ vimrc_url}}" dest=~/.vimrc force=yes

- name: Get vundle
  git:
      repo: https://github.com/VundleVim/Vundle.vim.git
      dest: ~/.vim/bundle/Vundle.vim

- name: Install vim plugins
  command: vim +PluginInstall +qall chdir=/tmp
